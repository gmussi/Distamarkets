<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\Distamarkets.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Distamarkets.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>111/111</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">77.08% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>37/48</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>18/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>111/111</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">78×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.7;
&nbsp;
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "erc-payable-token/contracts/token/ERC1363/IERC1363Spender.sol";
&nbsp;
import "hardhat/console.sol";
&nbsp;
/// @title A pot-style betting platform
/// @author Guilherme Mussi &lt;github.com/gmussi&gt;
/// @notice Contract current in MVP stage, being developed in increment steps towards Wallfair Whitepaper
/// @dev On every change, the entire contract should have full coverage and pass linter checks
contract Distamarkets is IERC1363Spender {
    using SafeERC20 for IERC20;
&nbsp;
    event MarketCreated(
        bytes32 indexed marketId_,
        address indexed oracle_,
        uint256 indexed closingTime_,
        uint256 numOutcomes_
    );
&nbsp;
    event StakeChanged(
        bytes32 indexed marketId,
        uint256 outcomeId_,
        address indexed user,
        uint256 oldBalance,
        uint256 newBalance
    );
&nbsp;
    event MarketStateChanged(
        bytes32 indexed marketId,
        MarketState indexed oldState,
        MarketState indexed newState
    );
&nbsp;
    enum MarketState {
        OPEN,
        ENDED,
        RESOLVED,
        DISPUTED,
        CLOSED,
        CANCELED
    }
&nbsp;
    struct Market {
        // market details
        address oracle;
        address creator;
        uint256 numOutcomes;
        uint256 closingTime;
        uint256 resolvedAt;
        uint256 totalStake;
        uint256 finalOutcomeId;
        uint256 feeCollected;
        MarketState state;
        // outcome index =&gt; user =&gt; user stake id
        mapping(uint256 =&gt; mapping(address =&gt; uint256)) stakes;
        mapping(uint256 =&gt; uint256) outcomeStakes;
    }
&nbsp;
    struct UserStake {
        bytes32 marketId;
        uint256 outcomeId;
        uint256 amount;
        address user;
    }
&nbsp;
    IERC20 internal immutable _token;
    uint256 internal _tokenBalance;
&nbsp;
    // uint256 _depositFee = 0.3 ether; // 0.3% fee
    uint256 _withdrawFeeRatio = 10; // 10% fee
&nbsp;
    // market id =&gt; Market
    mapping(bytes32 =&gt; Market) _markets;
&nbsp;
    UserStake[] _userStakes;
    mapping(address =&gt; uint256[]) _stakesByUser; // User =&gt; UserStake Ids
&nbsp;
    /// @notice This contract is intended to be used with WFAIR token (see README)
    /// @dev The contract operates bets using the specified ERC20 token
    /// @param token_ an ERC20 token
    constructor(IERC20 token_) {
        _token = token_;
    }
&nbsp;
    /// @notice This function creates a new market with the specified settings
    /// @dev The marketId should be the hash of the ipfs file containing the metadata of this market
    /// @param marketId_ A unique bytes32 identifying this market
    /// @param oracle_ The address who will be able to resolve this market
    /// @param closingTime_ The time in which this market can be closed
    /// @param numOutcomes_ The number of outcomes this market has
    function createMarket(
        bytes32 marketId_,
        address oracle_,
        uint256 closingTime_,
        uint256 numOutcomes_
    ) external {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            _markets[marketId_].oracle == address(0),
            "Market already exists"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(oracle_ != address(0), "Invalid oracle address");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            closingTime_ &gt; block.timestamp,
            "Cannot create markets that close on the past"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(numOutcomes_ &gt;= 2, "Market needs at least 2 outcomes");
&nbsp;
        // Creates a market
        Market storage market = _markets[marketId_];
        market.oracle = oracle_;
        market.creator = msg.sender;
        market.numOutcomes = numOutcomes_;
        market.closingTime = closingTime_;
        market.state = MarketState.OPEN;
&nbsp;
        emit MarketCreated(marketId_, oracle_, closingTime_, numOutcomes_);
    }
&nbsp;
    /// @notice Use ERC1363 callback to avoid user needing to approve deposit before-hand
    /// @param sender_ The user who made the ERC20 approval
    /// @param amount_ The amount of tokens approved
    /// @param data_ Encoded abi with (bytes32, uint256) for (market id, 0-based outcome index)
    function onApprovalReceived(
        address sender_,
        uint256 amount_,
        bytes calldata data_
    ) external override returns (bytes4) {
        require(amount_ &gt; 0, "Cannot add 0 stake");
        require(sender_ != address(0), "Invalid sender");
&nbsp;
        // extract encoded data
        bytes32 marketId_;
        uint256 outcomeId_;
        (marketId_, outcomeId_) = abi.decode(data_, (bytes32, uint256));
&nbsp;
        // load market and validate initialization
        Market storage market = _markets[marketId_];
        require(
            market.oracle != address(0),
            "Market not found or not initialized"
        );
        require(isMarketOpen(marketId_), "Market is not open");
&nbsp;
        // update indexed values
        market.totalStake = market.totalStake + amount_;
        market.outcomeStakes[outcomeId_] =
            market.outcomeStakes[outcomeId_] +
            amount_;
&nbsp;
        // user already has stake?
        uint256 stakeId = market.stakes[outcomeId_][sender_];
        UserStake storage stake;
&nbsp;
        if (stakeId == 0) {
            // stake does not exist yet
            _userStakes.push();
            stakeId = _userStakes.length;
            stake = _userStakes[stakeId - 1];
            stake.marketId = marketId_;
            stake.outcomeId = outcomeId_;
            stake.user = sender_;
&nbsp;
            _stakesByUser[sender_].push(stakeId);
            market.stakes[outcomeId_][sender_] = stakeId;
        } else {
            // loading existing stake
            stake = _userStakes[stakeId - 1];
        }
&nbsp;
        // update stake amount
        uint256 oldBalance = stake.amount;
        stake.amount = stake.amount + amount_;
&nbsp;
        // make the approved token transfer and update balance
        _token.safeTransferFrom(sender_, address(this), amount_);
        updateBalance();
&nbsp;
        emit StakeChanged(
            marketId_,
            outcomeId_,
            sender_,
            oldBalance,
            stake.amount
        );
&nbsp;
        return this.onApprovalReceived.selector;
    }
&nbsp;
    /// @notice Refund the stake from a canceled event
    /// @param stakeId_ Id of the stake
    function refund(uint256 stakeId_) external {
        // load stake and market
        UserStake storage stake = _userStakes[stakeId_ - 1];
        Market storage market = _markets[stake.marketId];
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(market.state == MarketState.CANCELED, "Market must be canceled");
&nbsp;
        console.log("market.feeCollected ", market.feeCollected);
        console.log("market.totalStake ", market.totalStake);
        console.log("deno", (market.feeCollected * 1000 / market.totalStake));
&nbsp;
        // calculate reward to be given
        uint256 feeReward = (stake.amount * (market.feeCollected * 1000 / market.totalStake)) / 1000;
&nbsp;
        // transfer amount and extra reward to user
        _token.safeTransfer(msg.sender, stake.amount + feeReward);
&nbsp;
        // update amounts
        market.feeCollected = market.feeCollected - feeReward;
        market.totalStake = market.totalStake - (stake.amount + feeReward);
        market.outcomeStakes[stake.outcomeId] = market.outcomeStakes[stake.outcomeId] - stake.amount;
        stake.amount = 0;
&nbsp;
        emit StakeChanged(stake.marketId, stake.outcomeId, msg.sender, stake.amount, 0);
    }
&nbsp;
    /// @notice Removes a stake (minus withdraw fee) from a market. User can remove only part of the stake.
    /// @param stakeId_ Id of the stake
    /// @param amount_ Amount to be removed
    function removeStake(uint256 stakeId_, uint256 amount_) external {
        require(amount_ &gt; 0, "Cannot remove 0 stake");
&nbsp;
        // load stake
        UserStake storage stake = _userStakes[stakeId_ - 1];
&nbsp;
        // cannot remove stake from closed market
        require(isMarketOpen(stake.marketId), "Market must be open");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(msg.sender == stake.user, "Cant remove stake of others");
&nbsp;
        // users cannot remove more stake then they have
        Market storage market = _markets[stake.marketId];
        require(stake.amount &gt;= amount_, "Amount exceeds current stake");
&nbsp;
        // calculate fees
        uint256 feeAmount = amount_ / _withdrawFeeRatio;
        uint256 amountMinusFee = amount_ - feeAmount;
&nbsp;
        // update indexed values (do NOT remove fee)
        market.totalStake = market.totalStake - amountMinusFee;
        market.outcomeStakes[stake.outcomeId] =
            market.outcomeStakes[stake.outcomeId] -
            amountMinusFee;
        market.feeCollected = market.feeCollected + feeAmount;
&nbsp;
        // update user balance (REMOVE whole amount (with fee) in this case)
        uint256 oldBalance = stake.amount;
        stake.amount = stake.amount - amount_;
&nbsp;
        // transfer the tokens to the user (MINUS FEE)
        _token.safeTransfer(msg.sender, amountMinusFee);
        updateBalance();
&nbsp;
        emit StakeChanged(
            stake.marketId,
            stake.outcomeId,
            msg.sender,
            oldBalance,
            stake.amount
        );
    }
&nbsp;
    /// @notice Get the stored information of a market
    /// @param marketId_ Id of the market
    function getMarket(bytes32 marketId_)
        public
        view
        returns (
            address,
            address,
            uint256,
            uint256,
            uint256,
            uint256,
            uint256,
            uint256,
            MarketState
        )
    {
        // load market
        Market storage market = _markets[marketId_];
&nbsp;
        // ensure the state is correct upon retrieval
        MarketState state = market.state;
        if (state == MarketState.OPEN &amp;&amp; block.timestamp &lt; market.closingTime) {
            state = MarketState.ENDED;
        }
&nbsp;
        return (
            market.oracle,
            market.creator,
            market.numOutcomes,
            market.closingTime,
            market.resolvedAt,
            market.totalStake,
            market.finalOutcomeId,
            market.feeCollected,
            market.state
        );
    }
&nbsp;
    /// @notice Set market to the RESOLVED state with the outcome provided
    /// @dev The final outcome provided here will define who wins this bet
    /// @param marketId_ Id of the market
    /// @param finalOutcomeId_ 0-based outcome id of the winning outcome
    function resolveMarket(bytes32 marketId_, uint256 finalOutcomeId_)
        external
    {
        Market storage market = _markets[marketId_];
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            msg.sender == market.oracle,
            "Only the oracle can resolve the market"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            market.state == MarketState.OPEN,
            "Only open markets can be resolved"
        );
        require(
            block.timestamp &gt; market.closingTime,
            "Market can only be closed after the specified period"
        );
&nbsp;
        MarketState oldState = market.state;
&nbsp;
        market.state = MarketState.RESOLVED;
        market.resolvedAt = block.timestamp;
        market.finalOutcomeId = finalOutcomeId_;
&nbsp;
        emit MarketStateChanged(marketId_, oldState, MarketState.RESOLVED);
    }
&nbsp;
    /// @notice This function sets the market as CANCELED
    /// @dev Check README.md for a breakdown of the rules
    /// @param marketId_ Id of the market
    function cancelMarket(bytes32 marketId_) external {
        Market storage market = _markets[marketId_];
&nbsp;
        // validate the various rules for cancelation
        require(
            market.state != MarketState.CANCELED,
            "Market already CANCELED"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            market.state != MarketState.CLOSED,
            "CLOSED markets can't be canceled anymore"
        );
        require(
            market.state != MarketState.OPEN ||
                (msg.sender == market.creator || msg.sender == market.oracle),
            "Only creator OR oracle can cancel OPEN market"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            market.state != MarketState.ENDED || msg.sender == market.oracle,
            "Only oracle can cancel ENDED markets"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            market.state != MarketState.DISPUTED || msg.sender == market.oracle,
            "Only oracle can cancel DISPUTED markets"
        );
        require(
            market.state != MarketState.RESOLVED,
            "Resolved markets cannot be canceled without dispute"
        );
&nbsp;
        // set new state as CANCELED
        MarketState oldState = market.state;
        MarketState newState = MarketState.CANCELED;
        market.state = newState;
&nbsp;
        emit MarketStateChanged(marketId_, oldState, MarketState.CANCELED);
    }
&nbsp;
    /*function withdrawReward(uint256 stakeId_) external {
        UserStake storage stake = _userStakes[stakeId_ - 1];
&nbsp;
        uint256 reward = _getReward(stake);
    }*/
&nbsp;
    /// @notice Calculate the POTENTIAL reward for a stake position in case of a win scenario
    /// @param stakeId_ Id of the stake
    function calculateReward(uint256 stakeId_) external view returns (uint256) {
        UserStake storage stake = _userStakes[stakeId_ - 1];
&nbsp;
        return _calculateReward(stake);
    }
&nbsp;
    /// @dev Calculates the reward of a stake on a win scenario by dividing the entire pot among the holders
    /// @param stake_ The UserStake to be calculated from
    function _calculateReward(UserStake storage stake_)
        internal
        view
        returns (uint256)
    {
        Market storage market = _markets[stake_.marketId];
&nbsp;
        uint256 totalStake = market.totalStake;
&nbsp;
        uint256 outcomeStake = market.outcomeStakes[stake_.outcomeId];
&nbsp;
        uint256 rewardBucket = totalStake - outcomeStake;
&nbsp;
        uint256 finalStake = (stake_.amount * rewardBucket) / outcomeStake;
&nbsp;
        return finalStake;
    }
&nbsp;
    /// @notice Reloads the token balance for this contract
    function updateBalance() public {
        // Retrieve amount of tokens held in contract
        _tokenBalance = _token.balanceOf(address(this));
    }
&nbsp;
    /// @notice Get the id of a stake based on the information provided
    /// @param holder_ the user to retrieve the stake from
    /// @param marketId_ Id of the market
    /// @param outcomeId_ Id of the outcome
    function getStakeId(
        address holder_,
        bytes32 marketId_,
        uint256 outcomeId_
    ) public view returns (uint256) {
        return _markets[marketId_].stakes[outcomeId_][holder_];
    }
&nbsp;
    /// @notice Get the total stake (pot) of this market
    /// @param marketId_ Id of the market
    function getMarketTotalStake(bytes32 marketId_)
        public
        view
        returns (uint256)
    {
        return _markets[marketId_].totalStake;
    }
&nbsp;
    /// @notice Get all stakes associated with a user
    /// @param address_ Address of user
    function getUserStakes(address address_)
        public
        view
        returns (uint256[] memory)
    {
        return _stakesByUser[address_];
    }
&nbsp;
    /// @notice Get the stake information
    /// @param stakeId_ Id of the stake
    function getStake(uint256 stakeId_) public view returns (UserStake memory) {
        return _userStakes[stakeId_ - 1];
    }
&nbsp;
    /// @notice This function returns the ERC20 token associated upon contract creation
    function token() public view returns (IERC20) {
        return _token;
    }
&nbsp;
    /// @notice This function returns the current token balance of this contract
    function tokenBalance() public view returns (uint256) {
        return _tokenBalance;
    }
&nbsp;
    /// @notice This function queries if a market is open
    /// @param marketId_ Id of the market
    function isMarketOpen(bytes32 marketId_) public view returns (bool) {
        Market storage market = _markets[marketId_];
        return
            market.state == MarketState.OPEN &amp;&amp;
            block.timestamp &lt; market.closingTime;
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon May 23 2022 12:21:16 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
